import { __decorate } from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { IonicRatingService } from './ionic-rating.service';
var IonicRatingComponent = /** @class */ (function () {
    function IonicRatingComponent(ionicRatingService) {
        this.ionicRatingService = ionicRatingService;
        this.iconsArray = [];
        this.ratingChanged = new EventEmitter();
        this.readonly = 'false';
        this.activeColor = '#488aff';
        this.defaultColor = '#aaaaaa';
        this.activeIcon = 'star';
        this.defaultIcon = 'star-outline';
        this.halfIcon = 'star-half';
        this.halfStar = 'false';
        this.maxRating = 5;
        this.fontSize = '28px';
        this.eventInfo = (function () {
            var id = new Date().getTime();
            var topic = "star-rating:" + id + ":changed";
            return {
                topic: topic,
            };
        })();
        this.Math = Math;
        this.parseFloat = parseFloat;
    }
    IonicRatingComponent_1 = IonicRatingComponent;
    Object.defineProperty(IonicRatingComponent.prototype, "rating", {
        get: function () {
            return this._rating;
        },
        set: function (val) {
            this._rating = val;
            if (this.onChange) {
                this.onChange(val);
            }
        },
        enumerable: true,
        configurable: true
    });
    IonicRatingComponent.prototype.ngOnInit = function () {
        this.rating = this.rating || 3; //default after input`s initialization
        for (var i = 0; i < this.maxRating; i++) {
            this.iconsArray.push(i);
        }
    };
    IonicRatingComponent.prototype.writeValue = function (obj) {
        this.rating = obj;
    };
    IonicRatingComponent.prototype.registerOnChange = function (fn) {
        this.onChange = fn;
    };
    IonicRatingComponent.prototype.registerOnTouched = function (fn) {
        this.onTouched = fn;
    };
    IonicRatingComponent.prototype.setDisabledState = function (isDisabled) {
        this.readonly = isDisabled ? "true" : "false";
    };
    IonicRatingComponent.prototype.changeRating = function (event) {
        if (this.readonly && this.readonly === 'true')
            return;
        // event is different for firefox and chrome
        var id = event.target.id ? parseInt(event.target.id) : parseInt(event.target.parentElement.id);
        if (this.halfStar && this.halfStar === 'true') {
            this.rating = ((this.rating - id > 0) && (this.rating - id <= 0.5)) ? id + 1 : id + .5;
        }
        else {
            this.rating = id + 1;
        }
        // subscribe this event to get the changed value in your parent compoanent
        this.ionicRatingService.publishStartRatingChanged(this.rating);
        this.ionicRatingService.publishTopic(this.eventInfo.topic, this.rating);
        // unique event
        this.ratingChanged.emit(this.rating);
    };
    var IonicRatingComponent_1;
    IonicRatingComponent.ctorParameters = function () { return [
        { type: IonicRatingService }
    ]; };
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "rating", null);
    __decorate([
        Output()
    ], IonicRatingComponent.prototype, "ratingChanged", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "readonly", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "activeColor", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "defaultColor", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "activeIcon", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "defaultIcon", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "halfIcon", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "halfStar", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "maxRating", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "fontSize", void 0);
    IonicRatingComponent = IonicRatingComponent_1 = __decorate([
        Component({
            selector: 'ionic-rating-component',
            template: "\n    <div class=\"ionic5-star-rating\">\n      <ion-button size=\"large\" fill=\"clear\" class=\"rate-button\" [ngStyle]=\"{'width' : fontSize, 'height' : fontSize}\" *ngFor=\"let index of iconsArray\" id=\"{{index}}\" (click)=\"changeRating($event)\">\n        <ion-icon [ngStyle]=\"{'color': ((halfStar === 'false' && index < this.Math.round(this.parseFloat(rating))) || (halfStar === 'true' && index < this.parseFloat(rating))) ? activeColor : defaultColor, 'font-size' : fontSize }\" name=\"{{(halfStar ==='true' && (rating - index > 0) && (rating - index <= 0.5)) ? halfIcon : (index < this.Math.round(this.parseFloat(rating))) ? activeIcon : defaultIcon}}\"></ion-icon>\n      </ion-button>\n    </div>\n  ",
            providers: [
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: IonicRatingComponent_1,
                    multi: true,
                },
            ],
            styles: ["\n    .rate-button {\n            --padding-bottom:0;\n            --padding-end:0;\n            --padding-start:0;\n            --padding-top:0;\n    }\n  "]
        })
    ], IonicRatingComponent);
    return IonicRatingComponent;
}());
export { IonicRatingComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW9uaWMtcmF0aW5nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2lvbmljLXJhdGluZy1jb21wb25lbnQvIiwic291cmNlcyI6WyJsaWIvaW9uaWMtcmF0aW5nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMvRSxPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUEwQjVEO0lBZUUsOEJBQW9CLGtCQUFzQztRQUF0Qyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBVTFELGVBQVUsR0FBYSxFQUFFLENBQUM7UUFFMUIsa0JBQWEsR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUVqRSxhQUFRLEdBQVcsT0FBTyxDQUFDO1FBRTNCLGdCQUFXLEdBQVcsU0FBUyxDQUFDO1FBRWhDLGlCQUFZLEdBQVcsU0FBUyxDQUFDO1FBRWpDLGVBQVUsR0FBVyxNQUFNLENBQUM7UUFFNUIsZ0JBQVcsR0FBVyxjQUFjLENBQUM7UUFFckMsYUFBUSxHQUFXLFdBQVcsQ0FBQztRQUUvQixhQUFRLEdBQVcsT0FBTyxDQUFDO1FBRTNCLGNBQVMsR0FBVyxDQUFDLENBQUM7UUFFdEIsYUFBUSxHQUFXLE1BQU0sQ0FBQztRQUVWLGNBQVMsR0FBRyxDQUFDO1lBQzNCLElBQU0sRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDaEMsSUFBTSxLQUFLLEdBQUcsaUJBQWUsRUFBRSxhQUFVLENBQUM7WUFDMUMsT0FBTztnQkFDTCxLQUFLLE9BQUE7YUFDTixDQUFDO1FBQ0osQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQXJDSCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztJQUMvQixDQUFDOzZCQWxCVSxvQkFBb0I7SUFFL0Isc0JBQVcsd0NBQU07YUFRakI7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDdEIsQ0FBQzthQVZELFVBQWtCLEdBQVc7WUFDM0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7WUFDbkIsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNqQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3BCO1FBQ0gsQ0FBQzs7O09BQUE7SUFnREQsdUNBQVEsR0FBUjtRQUNFLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FBQyxzQ0FBc0M7UUFDdEUsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDdkMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDekI7SUFDSCxDQUFDO0lBRUQseUNBQVUsR0FBVixVQUFXLEdBQVc7UUFDcEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7SUFDcEIsQ0FBQztJQUVELCtDQUFnQixHQUFoQixVQUFpQixFQUFPO1FBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxnREFBaUIsR0FBakIsVUFBa0IsRUFBTztRQUN2QixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUN0QixDQUFDO0lBRUQsK0NBQWdCLEdBQWhCLFVBQWtCLFVBQW1CO1FBQ25DLElBQUksQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUNoRCxDQUFDO0lBRUQsMkNBQVksR0FBWixVQUFhLEtBQUs7UUFDaEIsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssTUFBTTtZQUFFLE9BQU87UUFDdEQsNENBQTRDO1FBQzVDLElBQUksRUFBRSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQy9GLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLE1BQU0sRUFBRTtZQUM3QyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7U0FDeEY7YUFBTTtZQUNMLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztTQUN0QjtRQUNELDBFQUEwRTtRQUMxRSxJQUFJLENBQUMsa0JBQWtCLENBQUMseUJBQXlCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9ELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hFLGVBQWU7UUFDZixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDdkMsQ0FBQzs7O2dCQTdFdUMsa0JBQWtCOztJQWIxRDtRQURDLEtBQUssRUFBRTtzREFNUDtJQW9CRDtRQURDLE1BQU0sRUFBRTsrREFDd0Q7SUFFakU7UUFEQyxLQUFLLEVBQUU7MERBQ21CO0lBRTNCO1FBREMsS0FBSyxFQUFFOzZEQUN3QjtJQUVoQztRQURDLEtBQUssRUFBRTs4REFDeUI7SUFFakM7UUFEQyxLQUFLLEVBQUU7NERBQ29CO0lBRTVCO1FBREMsS0FBSyxFQUFFOzZEQUM2QjtJQUVyQztRQURDLEtBQUssRUFBRTswREFDdUI7SUFFL0I7UUFEQyxLQUFLLEVBQUU7MERBQ21CO0lBRTNCO1FBREMsS0FBSyxFQUFFOzJEQUNjO0lBRXRCO1FBREMsS0FBSyxFQUFFOzBEQUNrQjtJQTdDZixvQkFBb0I7UUF4QmhDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSx3QkFBd0I7WUFDbEMsUUFBUSxFQUFFLDJzQkFNVDtZQVFELFNBQVMsRUFBRTtnQkFDVDtvQkFDRSxPQUFPLEVBQUUsaUJBQWlCO29CQUMxQixXQUFXLEVBQUUsc0JBQW9CO29CQUNqQyxLQUFLLEVBQUUsSUFBSTtpQkFDWjthQUNGO3FCQWRXLDhKQU9YO1NBUUYsQ0FBQztPQUNXLG9CQUFvQixDQTZGaEM7SUFBRCwyQkFBQztDQUFBLEFBN0ZELElBNkZDO1NBN0ZZLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IElvbmljUmF0aW5nU2VydmljZSB9IGZyb20gJy4vaW9uaWMtcmF0aW5nLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpb25pYy1yYXRpbmctY29tcG9uZW50JyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IGNsYXNzPVwiaW9uaWM1LXN0YXItcmF0aW5nXCI+XG4gICAgICA8aW9uLWJ1dHRvbiBzaXplPVwibGFyZ2VcIiBmaWxsPVwiY2xlYXJcIiBjbGFzcz1cInJhdGUtYnV0dG9uXCIgW25nU3R5bGVdPVwieyd3aWR0aCcgOiBmb250U2l6ZSwgJ2hlaWdodCcgOiBmb250U2l6ZX1cIiAqbmdGb3I9XCJsZXQgaW5kZXggb2YgaWNvbnNBcnJheVwiIGlkPVwie3tpbmRleH19XCIgKGNsaWNrKT1cImNoYW5nZVJhdGluZygkZXZlbnQpXCI+XG4gICAgICAgIDxpb24taWNvbiBbbmdTdHlsZV09XCJ7J2NvbG9yJzogKChoYWxmU3RhciA9PT0gJ2ZhbHNlJyAmJiBpbmRleCA8IHRoaXMuTWF0aC5yb3VuZCh0aGlzLnBhcnNlRmxvYXQocmF0aW5nKSkpIHx8IChoYWxmU3RhciA9PT0gJ3RydWUnICYmIGluZGV4IDwgdGhpcy5wYXJzZUZsb2F0KHJhdGluZykpKSA/IGFjdGl2ZUNvbG9yIDogZGVmYXVsdENvbG9yLCAnZm9udC1zaXplJyA6IGZvbnRTaXplIH1cIiBuYW1lPVwie3soaGFsZlN0YXIgPT09J3RydWUnICYmIChyYXRpbmcgLSBpbmRleCA+IDApICYmIChyYXRpbmcgLSBpbmRleCA8PSAwLjUpKSA/IGhhbGZJY29uIDogKGluZGV4IDwgdGhpcy5NYXRoLnJvdW5kKHRoaXMucGFyc2VGbG9hdChyYXRpbmcpKSkgPyBhY3RpdmVJY29uIDogZGVmYXVsdEljb259fVwiPjwvaW9uLWljb24+XG4gICAgICA8L2lvbi1idXR0b24+XG4gICAgPC9kaXY+XG4gIGAsIHN0eWxlczogW2BcbiAgICAucmF0ZS1idXR0b24ge1xuICAgICAgICAgICAgLS1wYWRkaW5nLWJvdHRvbTowO1xuICAgICAgICAgICAgLS1wYWRkaW5nLWVuZDowO1xuICAgICAgICAgICAgLS1wYWRkaW5nLXN0YXJ0OjA7XG4gICAgICAgICAgICAtLXBhZGRpbmctdG9wOjA7XG4gICAgfVxuICBgXSxcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogSW9uaWNSYXRpbmdDb21wb25lbnQsXG4gICAgICBtdWx0aTogdHJ1ZSxcbiAgICB9LFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBJb25pY1JhdGluZ0NvbXBvbmVudCBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBPbkluaXQge1xuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IHJhdGluZyh2YWw6IG51bWJlcikge1xuICAgIHRoaXMuX3JhdGluZyA9IHZhbDtcbiAgICBpZiAodGhpcy5vbkNoYW5nZSkge1xuICAgICAgdGhpcy5vbkNoYW5nZSh2YWwpO1xuICAgIH1cbiAgfVxuXG5cbiAgcHVibGljIGdldCByYXRpbmcoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fcmF0aW5nO1xuICB9XG5cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGlvbmljUmF0aW5nU2VydmljZTogSW9uaWNSYXRpbmdTZXJ2aWNlKSB7XG4gICAgdGhpcy5NYXRoID0gTWF0aDtcbiAgICB0aGlzLnBhcnNlRmxvYXQgPSBwYXJzZUZsb2F0O1xuICB9XG4gIHByaXZhdGUgX3JhdGluZzogbnVtYmVyO1xuICBwcml2YXRlIG9uQ2hhbmdlOiBhbnk7XG4gIHByaXZhdGUgb25Ub3VjaGVkOiBhbnk7XG4gIHB1YmxpYyBkaXNhYmxlZDogYm9vbGVhbjtcbiAgTWF0aDogYW55O1xuICBwYXJzZUZsb2F0OiBhbnk7XG4gIGljb25zQXJyYXk6IG51bWJlcltdID0gW107XG4gIEBPdXRwdXQoKVxuICByYXRpbmdDaGFuZ2VkOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuICBASW5wdXQoKVxuICByZWFkb25seTogc3RyaW5nID0gJ2ZhbHNlJztcbiAgQElucHV0KClcbiAgYWN0aXZlQ29sb3I6IHN0cmluZyA9ICcjNDg4YWZmJztcbiAgQElucHV0KClcbiAgZGVmYXVsdENvbG9yOiBzdHJpbmcgPSAnI2FhYWFhYSc7XG4gIEBJbnB1dCgpXG4gIGFjdGl2ZUljb246IHN0cmluZyA9ICdzdGFyJztcbiAgQElucHV0KClcbiAgZGVmYXVsdEljb246IHN0cmluZyA9ICdzdGFyLW91dGxpbmUnO1xuICBASW5wdXQoKVxuICBoYWxmSWNvbjogc3RyaW5nID0gJ3N0YXItaGFsZic7XG4gIEBJbnB1dCgpXG4gIGhhbGZTdGFyOiBzdHJpbmcgPSAnZmFsc2UnO1xuICBASW5wdXQoKVxuICBtYXhSYXRpbmc6IG51bWJlciA9IDU7XG4gIEBJbnB1dCgpXG4gIGZvbnRTaXplOiBzdHJpbmcgPSAnMjhweCc7XG5cbiAgcHVibGljIHJlYWRvbmx5IGV2ZW50SW5mbyA9ICgoKSA9PiB7XG4gICAgY29uc3QgaWQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBjb25zdCB0b3BpYyA9IGBzdGFyLXJhdGluZzoke2lkfTpjaGFuZ2VkYDtcbiAgICByZXR1cm4ge1xuICAgICAgdG9waWMsXG4gICAgfTtcbiAgfSkoKTtcblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnJhdGluZyA9IHRoaXMucmF0aW5nIHx8IDM7IC8vZGVmYXVsdCBhZnRlciBpbnB1dGBzIGluaXRpYWxpemF0aW9uXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm1heFJhdGluZzsgaSsrKSB7XG4gICAgICB0aGlzLmljb25zQXJyYXkucHVzaChpKTtcbiAgICB9XG4gIH1cblxuICB3cml0ZVZhbHVlKG9iajogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5yYXRpbmcgPSBvYmo7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcbiAgfVxuXG4gIHNldERpc2FibGVkU3RhdGU/KGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLnJlYWRvbmx5ID0gaXNEaXNhYmxlZCA/IFwidHJ1ZVwiIDogXCJmYWxzZVwiO1xuICB9XG5cbiAgY2hhbmdlUmF0aW5nKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMucmVhZG9ubHkgJiYgdGhpcy5yZWFkb25seSA9PT0gJ3RydWUnKSByZXR1cm47XG4gICAgLy8gZXZlbnQgaXMgZGlmZmVyZW50IGZvciBmaXJlZm94IGFuZCBjaHJvbWVcbiAgICBsZXQgaWQgPSBldmVudC50YXJnZXQuaWQgPyBwYXJzZUludChldmVudC50YXJnZXQuaWQpIDogcGFyc2VJbnQoZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuaWQpO1xuICAgIGlmICh0aGlzLmhhbGZTdGFyICYmIHRoaXMuaGFsZlN0YXIgPT09ICd0cnVlJykge1xuICAgICAgdGhpcy5yYXRpbmcgPSAoKHRoaXMucmF0aW5nIC0gaWQgPiAwKSAmJiAodGhpcy5yYXRpbmcgLSBpZCA8PSAwLjUpKSA/IGlkICsgMSA6IGlkICsgLjU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmF0aW5nID0gaWQgKyAxO1xuICAgIH1cbiAgICAvLyBzdWJzY3JpYmUgdGhpcyBldmVudCB0byBnZXQgdGhlIGNoYW5nZWQgdmFsdWUgaW4geW91ciBwYXJlbnQgY29tcG9hbmVudFxuICAgIHRoaXMuaW9uaWNSYXRpbmdTZXJ2aWNlLnB1Ymxpc2hTdGFydFJhdGluZ0NoYW5nZWQodGhpcy5yYXRpbmcpO1xuICAgIHRoaXMuaW9uaWNSYXRpbmdTZXJ2aWNlLnB1Ymxpc2hUb3BpYyh0aGlzLmV2ZW50SW5mby50b3BpYywgdGhpcy5yYXRpbmcpO1xuICAgIC8vIHVuaXF1ZSBldmVudFxuICAgIHRoaXMucmF0aW5nQ2hhbmdlZC5lbWl0KHRoaXMucmF0aW5nKTtcbiAgfVxufVxuIl19